@model KhmerFestival.Web.Models.Location
@using System.Collections.Generic
@using System.Linq

@{
    ViewData["Title"] = Model?.Name ?? "Chi tiết địa điểm";
}

@if (Model == null)
{
    <div class="alert alert-warning">Không tìm thấy địa điểm.</div>
}
else
{
    <div class="row">
        <div class="col-md-8">
            <h1 class="mb-3">@Model.Name</h1>

            @* Hiển thị cấp + địa điểm cha (nếu có) *@
            <p class="text-muted">
                @if (Model.Level.HasValue)
                {
                    string levelText = Model.Level.Value switch
                    {
                        1 => "Cấp tỉnh / thành phố",
                        2 => "Cấp quận / huyện",
                        3 => "Cấp xã / phường",
                        _ => "Địa điểm"
                    };
                    @levelText
                }
                else
                {
                    @:Địa điểm
                }

                @if (Model.Parent != null)
                {
                    @:  • Thuộc: @Model.Parent.Name
                }
            </p>

            @* Ghi chú / mô tả ngắn *@
            @if (!string.IsNullOrEmpty(Model.Notes))
            {
                <div class="mb-3">
                    <h5>Ghi chú</h5>
                    <p>@Model.Notes</p>
                </div>
            }

            @* Ngày tạo *@
            <p class="small text-muted">
                Tạo lúc: @Model.CreatedAtUtc.ToString("dd/MM/yyyy HH:mm")
            </p>

            @* Danh sách lễ hội tại địa điểm này *@
            @if (ViewBag.Festivals != null)
            {
                var festivals = ViewBag.Festivals as IEnumerable<dynamic>;

                if (festivals != null && festivals.Any())
                {
                    <hr />
                    <h4 class="mt-3">Các lễ hội diễn ra tại đây</h4>
                    <ul class="list-unstyled">
                        @foreach (var f in festivals)
                        {
                            <li class="mb-2">
                                <a asp-controller="Festival"
                                   asp-action="Detail"
                                   asp-route-slug="@f.Slug">
                                    @f.Name
                                </a>
                                @if (f.StartDate != null)
                                {
                                    <span class="text-muted small">
                                        – @(((System.DateTime)f.StartDate).ToString("dd/MM/yyyy"))
                                    </span>
                                }
                            </li>
                        }
                    </ul>
                }
                else
                {
                    <hr />
                    <p class="text-muted">Chưa có thông tin lễ hội cụ thể tại địa điểm này.</p>
                }
            }
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Thông tin khác</h5>
                    <p class="small text-muted mb-0">
                        Đây là địa điểm dùng để gắn với các lễ hội Khmer trong hệ thống.
                    </p>
                </div>
            </div>
        </div>
    </div>
}
