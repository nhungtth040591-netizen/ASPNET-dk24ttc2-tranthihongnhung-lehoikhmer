@model KhmerFestival.Web.Models.Account

@{
    Layout = "_AdminLayout";
    var isNew = Model == null || Model.AccountId == 0;
    ViewData["Title"] = isNew ? "Thêm tài khoản" : "Sửa tài khoản";
}

<h2 class="mb-4">@ViewData["Title"]</h2>

<form asp-action="AccountEdit" method="post">
    @Html.AntiForgeryToken()

    <!-- Ẩn ID để biết đang thêm hay sửa -->
    <input type="hidden" asp-for="AccountId" />

    <div asp-validation-summary="All" class="text-danger mb-3"></div>

    <div class="form-row">
        <div class="form-group col-md-6">
            <label asp-for="Email"></label>
            @if (isNew)
            {
                <input asp-for="Email" class="form-control" />
            }
            else
            {
                <!-- Khi sửa thì khóa email lại cho an toàn -->
                <input asp-for="Email" class="form-control" readonly="readonly" />
            }
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>

        <div class="form-group col-md-6">
            <label asp-for="FullName"></label>
            <input asp-for="FullName" class="form-control" />
            <span asp-validation-for="FullName" class="text-danger"></span>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group col-md-6">
            <label asp-for="Phone"></label>
            <input asp-for="Phone" class="form-control" />
            <span asp-validation-for="Phone" class="text-danger"></span>
        </div>

        <div class="form-group col-md-6 d-flex align-items-center">
            <div class="form-check mt-3">
                <input asp-for="IsActive" class="form-check-input" />
                <label asp-for="IsActive" class="form-check-label"></label>
            </div>
        </div>
    </div>

    <hr />

    <h5 class="mb-3">Mật khẩu</h5>

    @if (isNew)
    {
        <!-- THÊM MỚI: bắt buộc nhập mật khẩu -->
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="NewPassword">Mật khẩu</label>
                <input type="password" name="NewPassword" id="NewPassword" class="form-control" />
            </div>
            <div class="form-group col-md-6">
                <label for="ConfirmPassword">Nhập lại mật khẩu</label>
                <input type="password" name="ConfirmPassword" id="ConfirmPassword" class="form-control" />
            </div>
        </div>
        <small class="text-muted">
            Mật khẩu sẽ được mã hóa trước khi lưu.
        </small>
    }
    else
    {
        <!-- SỬA: cho phép đặt lại mật khẩu (tùy chọn) -->
        <p class="text-muted mb-2">
            Để trống nếu không muốn đổi mật khẩu.
        </p>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="NewPassword">Mật khẩu mới</label>
                <input type="password" name="NewPassword" id="NewPassword" class="form-control" />
            </div>
            <div class="form-group col-md-6">
                <label for="ConfirmPassword">Nhập lại mật khẩu mới</label>
                <input type="password" name="ConfirmPassword" id="ConfirmPassword" class="form-control" />
            </div>
        </div>
    }

    @* Thông tin thời gian tạo/cập nhật (readonly) *@
    @if (!isNew)
    {
        <div class="mt-3 small text-muted">
            <div>Ngày tạo: @Model.CreatedAtUtc.ToString("dd/MM/yyyy HH:mm")</div>
            @if (Model.UpdatedAtUtc.HasValue)
            {
                <div>Cập nhật lần cuối: @Model.UpdatedAtUtc.Value.ToString("dd/MM/yyyy HH:mm")</div>
            }
        </div>
    }

    <div class="mt-4">
        <button type="submit" class="btn btn-primary">Lưu</button>
        <a asp-action="AccountList" class="btn btn-secondary ml-2">Quay lại</a>
    </div>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
